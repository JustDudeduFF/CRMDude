import { onValue, ref } from 'firebase/database'
import React, { useEffect, useState } from 'react'
import { Link } from 'react-router-dom'
import { db } from '../../FirebaseConfig';

export default function TicketTable() {
  const username = localStorage.getItem('susbsUserid');

  const ticketRef = ref(db, `Susbcriber/${username}/Tickets`);
  const [arrayticket, setArrayTicket] = useState([]);


  useEffect(() => {
    const fetchTicketsdata = onValue(ticketRef, (ticketSnap => {

      if(ticketSnap.exists()){
        const ticketArray = [];
        ticketSnap.forEach(Childticket => {
          const ticketno = Childticket.val().ticketno;
          const source = Childticket.val().source;
          const generatedate = Childticket.val().generatedate;
          const ticketconcern = Childticket.val().ticketconcern;
          const assignto = Childticket.val().assignto;
          const description = Childticket.val().description;
          const assigntime = Childticket.val().assigntime;
          const assigndate = Childticket.val().assigndate;
          const status = Childticket.val().status;
          const closedate = Childticket.val().closedate;
          const closetime = Childticket.val().closetime;

          ticketArray.push({ticketno, source, generatedate, ticketconcern, assignto, description, assigntime, assigndate, status});
        });
        setArrayTicket(ticketArray);
      }
    }))

    return () => fetchTicketsdata();
  }, [username])
  return (
    <div>

    
    <div style={{overflowY:'auto'}}>
                <table style={{borderCollapse:'collapse'}} className="table">
                <thead>
                    <tr>
                        <th style={{width:'120px'}} scope="col">Ticket No.</th>
                        <th style={{width:'120px'}} scope="col">Source</th>
                        <th style={{width:'120px'}} scope="col">Creation Date</th>
                        <th style={{width:'150px'}}  scope="col">Generated By</th>
                        <th style={{width:'150px'}} scope="col">Assigned to</th>
                        <th style={{width:'120px'}} scope="col">Assigned Time</th>
                        <th style={{width:'150px'}} scope="col">Closed By</th>
                        <th style={{width:'120px'}} scope="col">Close Timing</th>
                        <th style={{width:'90px'}}>TAT</th>
                        <th style={{width:'130px'}}>Current Status</th>
                        <th style={{width:'120px'}}>Remarks</th>
                        
                    </tr>
                </thead>
                <tbody className='table-group-divider'>

                  {
                    arrayticket.length > 0 ? (
                      arrayticket.map(({ticketno, source, generatedate, ticketconcern, assignto, description, assigntime, assigndate, status}, index) => (
                        <tr>
                        <td style={{color:'green ',  cursor:'pointer'}} className="btn" data-bs-toggle="dropdown" aria-expanded="false">{ticketno}</td>
                        <ul className="dropdown-menu">
                          <li><Link className='dropdown-item' style={{color:'black'}} id='link' to='modifyticket'>Update Ticket</Link></li>
                          <li><a className="dropdown-item" to="#">Cancel Ticket</a></li>
                          <li><a className="dropdown-item" to="#">Download Receipt</a></li>
                        </ul>
                            <td>{source}</td>
                            <td>{generatedate}</td>
                            <td>Shivam Chauhan</td>
                            <td>{assignto}</td>
                            <td>{`${assigndate} ${assigntime}`}</td>
                            <td>{closeby}</td>
                            <td>{closetime}</td>
                            <td>{tat}</td>
                            <td>{status}</td>
                            <td>{description}</td>
                            
                        </tr>
                      ))
                    ) : (
                      <td colSpan="8" style={{ textAlign: 'center' }}>No Tickets Availabale</td>
                    )
                  }
                
                </tbody>

                </table>

            </div>
            </div>

  )
}
